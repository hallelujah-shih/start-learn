# 基本使用

## 环境设置
```
# 网卡绑定
## 状态查看
./dpdk_nic_bind.py -s
## （手动）绑定网卡(根据自己的情况，选择ethx或者地址)
./dpdk_nic_bind.py -b igb_uio 0000:3b:00.0 0000:3b:00.1
## 交互式生成配置文件(tmux下不生效，不知道为啥)
./dpdk_setup_ports.py -i
或者一次生成
./dpdk_setup_ports.py -c 3b:00.0 3b:00.1 -o /etc/trex/trex_cfg.yaml
------------------------- cat trex_cfg.yaml -----------------------
### Config file generated by dpdk_setup_ports.py ###

- version: 2
  interfaces: ['3b:00.0', '3b:00.1']
  port_bandwidth_gb: 40
  port_info:
      - ip: 192.168.1.1
        default_gw: 192.168.1.2
      - ip: 192.168.2.1
        default_gw: 192.168.2.2

  platform:
      master_thread_id: 0
      latency_thread_id: 1
      dual_if:
        - socket: 0
          threads: [2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62]
-------------------------------------------------------------------

被测机器配置
## 配置地址
ip addr add 192.168.1.2/24 dev eth6
ip link set dev eth6 up

ip addr add 192.168.2.2/24 dev eth7
ip link set dev eth7 up

## 配置路由
echo "1" > /proc/sys/net/ipv4/ip_forward
route add -net 16.0.0.0 netmask 255.0.0.0 gw 192.168.1.1
route add -net 48.0.0.0 netmask 255.0.0.0 gw 192.168.2.1

## 如果要为了没有arp报文产生(工作在L2)，可以在终端执行 stats --ps，并基于配置的IP地址和mac地址进行配置
### trex机器配置调整
  port_info:
      - src_mac: 68:91:d0:65:53:c2
        dest_mac: 68:91:d0:67:75:68
      - src_mac: 68:91:d0:65:53:c3
        dest_mac: 68:91:d0:67:75:69

### 被测机器的arp设置
arp -i eth6 -s 192.168.1.1 68:91:d0:65:53:c2
arp -i eth7 -s 192.168.2.1 68:91:d0:65:53:c3
```

## 启动&基本测试

### stateless
```
# 启动服务
./t-rex-64 --cfg ./trex_cfg.yaml -i

# 启动客户端
./trex-console
# 查看状态
trex> stats --ps

# 小流量测试
trex> start -f stl/udp_1pkt_simple.py -m 1pps -d 60

trex> stats
可以看到port-0的opackets == port-1的ipackets
```

### statefull
```
# 启动服务端程序
./t-rex-64 --cfg ./trex_cfg.yaml -i --astf

# 小流量测试
trex> start -f astf/http_simple.py -m 10 -d 10
```

## 正式测试(stateless - 数据包重放)
```

```

## ref
* [trex-load-generator](https://satishdotpatel.github.io/trex-load-generator/)
